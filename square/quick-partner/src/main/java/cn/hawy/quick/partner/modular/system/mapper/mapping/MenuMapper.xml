<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.hawy.quick.partner.modular.system.mapper.MenuMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="cn.hawy.quick.partner.modular.system.entity.Menu">
        <id column="MENU_ID" property="menuId"/>
        <result column="CODE" property="code"/>
        <result column="PCODE" property="pcode"/>
        <result column="PCODES" property="pcodes"/>
        <result column="NAME" property="name"/>
        <result column="ICON" property="icon"/>
        <result column="URL" property="url"/>
        <result column="SORT" property="sort"/>
        <result column="LEVELS" property="levels"/>
        <result column="MENU_FLAG" property="menuFlag"/>
        <result column="DESCRIPTION" property="description"/>
        <result column="STATUS" property="status"/>
        <result column="NEW_PAGE_FLAG" property="newPageFlag"/>
        <result column="OPEN_FLAG" property="openFlag"/>
        <result column="CREATE_TIME" property="createTime"/>
        <result column="UPDATE_TIME" property="updateTime"/>
        <result column="CREATE_USER" property="createUser"/>
        <result column="UPDATE_USER" property="updateUser"/>
    </resultMap>

    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        MENU_ID AS menuId, CODE AS code, PCODE AS pcode, PCODES AS pcodes, NAME AS name, ICON AS icon, URL AS url, SORT AS sort, LEVELS AS levels, MENU_FLAG AS menuFlag, DESCRIPTION AS description, STATUS AS status, NEW_PAGE_FLAG AS newPageFlag, OPEN_FLAG AS openFlag, CREATE_TIME AS createTime, UPDATE_TIME AS updateTime, CREATE_USER AS createUser, UPDATE_USER AS updateUser
    </sql>

    <select id="getMenusByRoleIds" resultType="cn.hawy.quick.partner.core.common.node.MenuNode">
        SELECT
            m1.MENU_ID AS id,
            m1.ICON AS icon,
            (
                CASE
                    WHEN (m2.MENU_ID = 0 OR m2.MENU_ID IS NULL) THEN
                        0
                    ELSE
                        m2.MENU_ID
                    END
                ) AS parentId,
            m1.NAME as name,
            m1.URL as url,
            m1.levels as levels,
            m1.SORT as num
        FROM
            t_dept_menu m1
                LEFT join t_dept_menu m2 ON m1.PCODE = m2.CODE
        where 1=1
    </select>



</mapper>
